<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/07/22/first/"/>
    <url>/2023/07/22/first/</url>
    
    <content type="html"><![CDATA[<h1 id="first-23-7-21"><a href="#first-23-7-21" class="headerlink" title="first 23.7.21"></a>first 23.7.21</h1><h2 id="一、yxcms"><a href="#一、yxcms" class="headerlink" title="一、yxcms"></a>一、yxcms</h2><h3 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00.前言"></a>0x00.前言</h3><p>看了一篇php代码审计的博客，学习了一番:<a href="http://www.535yx.cn/">http://www.535yx.cn/</a></p><p>yxcms 使用的是canphp 的入门级别的MVC框架</p><p>源码下载地址：<a href="http://down.chinaz.com/soft/33853.htm">http://down.chinaz.com/soft/33853.htm</a></p><p>搭建使用的phpstudy、vscode</p><h3 id="0x01-MVC框架"><a href="#0x01-MVC框架" class="headerlink" title="0x01 MVC框架"></a>0x01 MVC框架</h3><p>Model View Controller ———模型、视图、控制器</p><p><img src="http://535yx.cn/usr/uploads/2022/11/2624244282.png" alt="80001-wvk8o6z5qmm.png"></p><h3 id="0x02-分析"><a href="#0x02-分析" class="headerlink" title="0x02 分析"></a>0x02 分析</h3><h4 id="1-结构"><a href="#1-结构" class="headerlink" title="1.结构"></a>1.结构</h4><p>看一下这个cms的结构</p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221042197.webp" alt="image-20230721220120969"></p><p>有  data；protected；public；upload ，一看意思猜出来了 ,对外访问可以看到的就是public目录,protexted 就是不可对外</p><p>protected&#x2F;apps&#x2F;admin </p><p>下面的目录  （app是应用目录）  </p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221042803.webp" alt="image-20230721215525868"></p><p>其实thinkphp的结构和这个也是差不多的。</p><h4 id="2-函数"><a href="#2-函数" class="headerlink" title="2.函数"></a>2.函数</h4><p>和大家复习一下php函数吧！</p><p>include(),require();fopen(),fwrite(),readfile();unlink(),eval()以及变体函数</p><p>addslashes函数可用于为存储在数据库中的字符串以及数据库查询语句准备合适的字符串。</p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221042897.webp" alt="image-20230720104547345"></p><p>htmlspecialchars() 函数把一些预定义的字符转换为 HTML 实体。 都可以用来防止注入。</p><h3 id="0x03-审计"><a href="#0x03-审计" class="headerlink" title="0x03 审计"></a>0x03 审计</h3><p>用seay扫一下</p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221042883.webp" alt="image-20230722103754171"></p><p>任意文件上传漏洞(protected&#x2F;apps&#x2F;appmanage&#x2F;controller&#x2F;indexController.php)</p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221138193.webp" alt="image-20230722111836678"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">//导入</span><br><span class="line">public function import($zip_file=&#x27;&#x27;)&#123;</span><br><span class="line">if(empty($zip_file))&#123;</span><br><span class="line">if( !$this-&gt;isPost() )&#123;</span><br><span class="line">$this-&gt;display();</span><br><span class="line">return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($_FILES[&#x27;file&#x27;][&#x27;size&#x27;] &lt; 0)&#123;</span><br><span class="line">$this-&gt;error(&#x27;请选择文件&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">$zip_file = $_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$zip_dir = BASE_PATH . &#x27;cache/tmp/&#x27; .md5($zip_file) .&#x27;/&#x27;;</span><br><span class="line">if(substr($zip_dir,0,1)==&quot;/&quot;)  $zip_dir=&#x27;.&#x27;.$zip_dir; //无法获得绝对路径情况</span><br><span class="line"></span><br><span class="line">$zip = new Zip();</span><br><span class="line">$zip-&gt;decompress($zip_file, $zip_dir);</span><br><span class="line">@unlink($zip_file);</span><br><span class="line"></span><br><span class="line">//获取app名称</span><br><span class="line">$app = &#x27;&#x27;;</span><br><span class="line">$arr = glob($zip_dir .&#x27;*/config.php&#x27;);</span><br><span class="line">if( !empty($arr) )&#123;</span><br><span class="line">if( preg_match(&#x27;#/([a-z0-9]+)/config.php#&#x27;, $arr[0], $matches))&#123;</span><br><span class="line">$app = $matches[1];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if( empty($app) )&#123;</span><br><span class="line">del_dir($zip_dir);</span><br><span class="line">$this-&gt;error(&#x27;安装包格式错误！&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//判断应用是否已经存在</span><br><span class="line">$app_path = BASE_PATH . &#x27;apps/&#x27; . $app . &#x27;/&#x27;;</span><br><span class="line">if( is_dir($app_path) )&#123;</span><br><span class="line">del_dir($zip_dir);</span><br><span class="line">$this-&gt;error($app .&#x27;应用已存在，请先卸载！&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//将数据拷贝到apps目录</span><br><span class="line">copy_dir($zip_dir . $app , $app_path);</span><br><span class="line">del_dir($zip_dir);</span><br><span class="line"></span><br><span class="line">//执行安装</span><br><span class="line">$_GET[&#x27;app&#x27;] = $app;</span><br><span class="line">$this-&gt;install();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当上传一个zip压缩包的时候，代码会去匹配压缩包中是否存在个文件夹(命名规则为a-z0-9)，以及文件夹中是否存在config.php文件。如果不存在的话即会返回“安装包格式错误”</p><p>判断了该应用是否存在，不存在的话就将数据拷贝到apps目录中。所以我们可以构造个压缩包进行上传</p><p>压缩包里面有config.php和phpinfo</p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221138374.webp" alt="image-20230722113614830"></p><h2 id="二、proxy代理"><a href="#二、proxy代理" class="headerlink" title="二、proxy代理"></a>二、proxy代理</h2><p>也是学习了前辈的博客 <a href="https://blog.zgsec.cn/index.php/archives/278/">https://blog.zgsec.cn/index.php/archives/278/</a></p><h3 id="一-代理vm虚拟机"><a href="#一-代理vm虚拟机" class="headerlink" title="一 代理vm虚拟机"></a>一 代理vm虚拟机</h3><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p><img src="C:\Users\33760\AppData\Roaming\Typora\typora-user-images\image-20230718110122083.png" alt="image-20230718110122083"></p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221039183.webp" alt="image-20230718110133499"></p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221039864.webp" alt="image-20230718110157338"></p><p>在虚拟机里面显示的</p><p>kail里面</p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221039252.webp" alt="image-20230718110225188"></p><p>win10 </p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221039137.webp" alt="image-20230718110356319"></p><h4 id="二-抓包小程序"><a href="#二-抓包小程序" class="headerlink" title="二 抓包小程序"></a>二 抓包小程序</h4><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221040592.webp" alt="image-20230718111256443"></p><p><img src="C:\Users\33760\AppData\Roaming\Typora\typora-user-images\image-20230718111315405.png" alt="image-20230718111315405"></p><p>配合bp</p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221040997.webp" alt="image-20230718112448087"></p><p>三、Proxifier进行内网渗透</p><p>好像使用使用 <code>Proxifier</code> 配合Frp对相关进程进行全局代理 ，我还没学会捏！</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/07/22/proxy%E4%BB%A3%E7%90%86/"/>
    <url>/2023/07/22/proxy%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="proxy代理"><a href="#proxy代理" class="headerlink" title="proxy代理"></a>proxy代理</h1><h3 id="一-代理vm虚拟机"><a href="#一-代理vm虚拟机" class="headerlink" title="一 代理vm虚拟机"></a>一 代理vm虚拟机</h3><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p><img src="C:\Users\33760\AppData\Roaming\Typora\typora-user-images\image-20230718110122083.png" alt="image-20230718110122083"></p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221039183.webp" alt="image-20230718110133499"></p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221039864.webp" alt="image-20230718110157338"></p><p>在虚拟机里面显示的</p><p>kail里面</p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221039252.webp" alt="image-20230718110225188"></p><p>win10 </p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221039137.webp" alt="image-20230718110356319"></p><h4 id="二-抓包小程序"><a href="#二-抓包小程序" class="headerlink" title="二 抓包小程序"></a>二 抓包小程序</h4><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221040592.webp" alt="image-20230718111256443"></p><p><img src="C:\Users\33760\AppData\Roaming\Typora\typora-user-images\image-20230718111315405.png" alt="image-20230718111315405"></p><p><img src="https://dongzao-1314466014.cos.ap-nanjing.myqcloud.com/pic/202307221040997.webp" alt="image-20230718112448087"></p><p>三、Proxifier进行内网渗透</p><p>还没学会捏！</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/07/18/web%E5%89%8D%E7%AB%AF%E9%BB%91%E5%AE%A2%E6%8A%80%E6%9C%AF%E6%8F%AD%E7%A7%98/"/>
    <url>/2023/07/18/web%E5%89%8D%E7%AB%AF%E9%BB%91%E5%AE%A2%E6%8A%80%E6%9C%AF%E6%8F%AD%E7%A7%98/</url>
    
    <content type="html"><![CDATA[<h1 id="web前端黑客技术揭秘"><a href="#web前端黑客技术揭秘" class="headerlink" title="web前端黑客技术揭秘"></a>web前端黑客技术揭秘</h1><p>重视某些安全风险最好的办法就是将风险最大化</p><p><a href="https://brian3376.github.io:80/">https://brian3376.github.io:80</a> 协议、域名、端口 </p><p><scheme>:&#x2F;&#x2F;<netloc>&#x2F;<path>?<query>#<fragment></p><p>DOM 文档对象模型 Document Object Model </p><p>在web服务器上做好权限分离，防止网站和网站之间过于信任出现都被攻克（木桶理论）</p><p>web安全事件角色  w3c、浏览器厂商、web厂商、攻击者、用户</p><p>通过javascript 可以获取DOM中的隐私数据</p><p>例：document.getElementByid(‘private_msg’).innerHTML;</p><p>document.getElementByiTagName(‘div’)[2].innerHTML;</p><p>AJAX风险没搞懂</p><p>模拟用户发起游览器请求也没懂</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/07/13/%E5%86%85%E7%BD%91%E7%9F%A5%E8%AF%861/"/>
    <url>/2023/07/13/%E5%86%85%E7%BD%91%E7%9F%A5%E8%AF%861/</url>
    
    <content type="html"><![CDATA[<h1 id="内网"><a href="#内网" class="headerlink" title="内网"></a>内网</h1><h3 id="工作组、域环境"><a href="#工作组、域环境" class="headerlink" title="工作组、域环境"></a>工作组、域环境</h3><p>systeminfo 详细信息</p><p>net start 启动服务</p><p>tasklist  任务列表</p><p>schtasks 计划任务</p><h4 id="网络信息收集"><a href="#网络信息收集" class="headerlink" title="网络信息收集"></a>网络信息收集</h4><p>ipconfig -all 判断是否存在域-dns</p><p>net view&#x2F;domain 判断是否存在域</p><p>net time &#x2F;domain 判断主域</p><p>netstat -ano 当前网络端口开放</p><h4 id="用户信息收集"><a href="#用户信息收集" class="headerlink" title="用户信息收集"></a>用户信息收集</h4><h5 id="常见默认用户身份"><a href="#常见默认用户身份" class="headerlink" title="常见默认用户身份"></a>常见默认用户身份</h5><p>Domain Admins 域管理员</p><p>Domain Computers 域内机器</p><p>Domain Controllers 域控制器</p><p>Domain Guest 域访客；权限低</p><p>Domain users：域用户</p><p>Enterpri Admins：企业系统管理员用户</p><h5 id="相关用户收集操作命令"><a href="#相关用户收集操作命令" class="headerlink" title="相关用户收集操作命令"></a>相关用户收集操作命令</h5><p> whoami &#x2F;all 用户权限</p><p>net config workstation 登录信息</p><p> net user 本地用户</p><p>net localgroup 本地用户组</p><p>net user&#x2F;domain 获取域用户信息</p><p>net group&#x2F;domain 获取域用户组信息</p><p>wmic useraccount get&#x2F;all 涉及域用户详细信息</p><p>net group  “Domain Admins” &#x2F;domain 查询域管理员账户</p><p>net group  “Enterprise Admins” &#x2F;domain 查询管理员用户组</p><p>net group “Domain Controllers” &#x2F;domain 查询域控制器</p><h4 id="凭据信息收集"><a href="#凭据信息收集" class="headerlink" title="凭据信息收集"></a>凭据信息收集</h4><p>mimikatz（win）获取密码</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
